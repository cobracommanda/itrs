//differentiate BA2 packages for CC, TN, FL#include '/Volumes/BEC/15 User Files/INDD SCRIPTS/primitive/main.js';var utility_path = '/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility';var itrs_root_path = '/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/BA2_based_on_pw/itrs';var projects_folder = Folder('/Volumes/BEC/15 User Files/INDD SCRIPTS/primitive/_JY_BU/JasonONE_DRIVE_UNSORTED/OneDrive - Benchmark Education/projects');var differentation_folder = Folder(projects_folder+'/BA2/itrs/differentation_materials'); var floop_folder = Folder(differentation_folder+'/floops');var standards_folder = Folder(differentation_folder+'/standards');var region = '';var myFiles = [];var currentFile;$.evalFile(utility_path+'/console.js');$.evalFile(utility_path+'/exporter.js');$.evalFile(utility_path+'/zone.js');$.evalFile(utility_path+'/library.js');$.evalFile(utility_path+'/json.js');start_log('log_BA2_eng_DIFFERENTIATION_' + app.getWWUser());$.evalFile(itrs_root_path+'/data/products.js');//this is based on the concept that 1) it will be included in /run, and 2) that we are always running SNI first.//make "national" (what I suspect is Florida)var fileSep = "/";if(File.fs=="Windows") fileSep = "\\";var selected_folder = Folder.selectDialog('Select the unit folder or the individual xcode folder.');var package_folder; //will be defined later// var myStuffFolder = Folder.selectDialog('What\'s the folder with the stuff you need?');// var myStuffFolder = Folder('/Volumes/user_files/User Files/0 - SCRIPTS/stuff_folder_batchregexgeneral');// var myFiles = product_folder.getFiles("*.html");var pleaseWaitWindow = new Window('palette', 'Please wait warmly while files are modified...');pleaseWaitWindow.bounds = [400,500,700,510];//pleaseWaitWindow.bringToFront();pleaseWaitWindow.show();//var pleaseWaitPanel = pleaseWaitWindow.add(pleaseWaitPanel, [0,0,200,30], 'Now modifying: ');var xcodeFolders = [];if(selected_folder.fsName.match(/X\d+/)){  xcodeFolders.push(selected_folder);}else{  GetXcodeFolders(selected_folder);}var product_folder, snixcode, sniProduct, grade, unit, xcode, fileCounter, dayLessonCounter, fixedHTML, bankxcode;for(var xf = 0; xf < xcodeFolders.length; xf++){  product_folder = xcodeFolders[xf];  snixcode = product_folder.fsName.match(/X\d+/)[0];  sniProduct = get_product_by_xcode(snixcode);  grade = sniProduct.grade;  unit = sniProduct.unit;  var xcode;  var fileCounter = 0;  var dayLessonCounter = 1; //only used in TN K-2  var fixedHTML;  var bankxcode; //used for alternateUtilities only  //differentiate  // var region = prompt('TN or CC?');  // var language = 'en';  // differentiate(region);  //alternate utilities  // var language = prompt('en or sp?'); //if running the original two aUs  // var region = prompt('SNI or CC?'); //if running formativeFix  alternateUtilities();}pleaseWaitWindow.close();alert('Done!');//FUNCTIONSfunction alternateUtilities(){  //html pages  makepdfpages();  //toc business  GetSubFolders(product_folder);  xcode = snixcode;  log(xcode);  log('Grade ' + grade + ' Unit ' + unit);  //ok time for TOC  var d = myFiles.length;  fileCounter = 0;  var lastCounter = 0;  log(d);  while (d--)   {      // grade = myFiles[d].fsName.match(/grade(\d|k)/i)[0].match(/(\d|k)/i)[0];      // if(grade == 'K') grade = 'k';      currentFile = myFiles[d];      // OPEN THE FILE      currentFile.open('r');      // pleaseWaitPanel.add(currentFile.name); //doesn't work      // pleaseWaitPanel.show();      // encoding!      currentFile.encoding = 'utf-8';      log('alternateUtilities attempt: ' + currentFile.fsName);      fixedHTML = currentFile.read();      // set lastCounter for comparison      lastCounter = fileCounter;      //DO STUFF      tocaddition();      if(fileCounter > lastCounter+1)      fileCounter = lastCounter+1;      if(fileCounter > lastCounter)      {         //WRITE THE FILE         currentFile.open('w');         currentFile.write(fixedHTML);         //fileCounter++;      }      currentFile.close();      // log('...file edited!');      // }  }}function tocaddition(){  // if(!fixedHTML.match(/AR1/)) //this means it wasn't switched to internal  // {    var gnun = 'G' + grade.toUpperCase() + 'U' + unit;    var unitpath = '/html';    var moreids = '';    moreids += '\t\t "' + gnun + 'OV1": "' + unitpath + '/1.html",\n';    moreids += '\t\t "' + gnun + 'OV2": "' + unitpath + '/2.html",\n';    moreids += '\t\t "' + gnun + 'OV3": "' + unitpath + '/3.html",\n';    moreids += '\t\t "' + gnun + 'OV4": "' + unitpath + '/4.html",\n';    moreids += '\t\t "' + gnun + 'OV5": "' + unitpath + '/5.html",\n';    moreids += '\t\t "' + gnun + 'OV6": "' + unitpath + '/6.html",\n';    moreids += '\t\t "' + gnun + 'OV7": "' + unitpath + '/7.html",\n';    moreids += '\t\t "' + gnun + 'OV8": "' + unitpath + '/8.html",\n';    moreids += '\t\t "' + gnun + 'UR1": "' + unitpath + '/9.html",\n';    moreids += '\t\t "' + gnun + 'UR2": "' + unitpath + '/10.html",\n';    moreids += '\t\t "' + gnun + 'UR3": "' + unitpath + '/11.html",\n';    moreids += '\t\t "' + gnun + 'UR4": "' + unitpath + '/12.html",\n';    moreids += '\t\t "' + gnun + 'UR5": "' + unitpath + '/13.html",\n';    moreids += '\t\t "' + gnun + 'UR6": "' + unitpath + '/14.html",\n';    moreids += '\t\t "' + gnun + 'UR7": "' + unitpath + '/15.html",\n';    moreids += '\t\t "' + gnun + 'UR8": "' + unitpath + '/16.html",\n';    moreids += '\t\t "' + gnun + 'UR9": "' + unitpath + '/17.html",\n';    moreids += '\t\t "' + gnun + 'UR10": "' + unitpath + '/18.html",\n';    if(grade.toLowerCase() == 'k' || grade.toLowerCase() == '1' || grade.toLowerCase() == '2')    {      moreids += '\t\t "' + gnun + 'W1G": "' + unitpath + '/19.html",\n';      moreids += '\t\t "' + gnun + 'W1P": "' + unitpath + '/20.html",\n';      moreids += '\t\t "' + gnun + 'W1D1": "' + unitpath + '/21.html",\n';      moreids += '\t\t "' + gnun + 'W1D2": "' + unitpath + '/22.html",\n';      moreids += '\t\t "' + gnun + 'W1D3": "' + unitpath + '/23.html",\n';      moreids += '\t\t "' + gnun + 'W1D4": "' + unitpath + '/24.html",\n';      moreids += '\t\t "' + gnun + 'W1D5": "' + unitpath + '/25.html",\n';      moreids += '\t\t "' + gnun + 'W2G": "' + unitpath + '/26.html",\n';      moreids += '\t\t "' + gnun + 'W2P": "' + unitpath + '/27.html",\n';      moreids += '\t\t "' + gnun + 'W2D1": "' + unitpath + '/28.html",\n';      moreids += '\t\t "' + gnun + 'W2D2": "' + unitpath + '/29.html",\n';      moreids += '\t\t "' + gnun + 'W2D3": "' + unitpath + '/30.html",\n';      moreids += '\t\t "' + gnun + 'W2D4": "' + unitpath + '/31.html",\n';      moreids += '\t\t "' + gnun + 'W2D5": "' + unitpath + '/32.html",\n';      moreids += '\t\t "' + gnun + 'W3G": "' + unitpath + '/33.html",\n';      moreids += '\t\t "' + gnun + 'W3P": "' + unitpath + '/34.html",\n';      moreids += '\t\t "' + gnun + 'W3D1": "' + unitpath + '/35.html",\n';      moreids += '\t\t "' + gnun + 'W3D2": "' + unitpath + '/36.html",\n';      moreids += '\t\t "' + gnun + 'W3D3": "' + unitpath + '/37.html",\n';      moreids += '\t\t "' + gnun + 'W3D4": "' + unitpath + '/38.html",\n';      moreids += '\t\t "' + gnun + 'W3D5": "' + unitpath + '/39.html",\n';      moreids += '\t\t "' + gnun + 'AR1": "' + unitpath + '/40.html",\n';      moreids += '\t\t "' + gnun + 'AR2": "' + unitpath + '/41.html",\n';      moreids += '\t\t "' + gnun + 'AR3": "' + unitpath + '/42.html",\n';      moreids += '\t\t "' + gnun + 'AR4": "' + unitpath + '/43.html",\n';      moreids += '\t\t "' + gnun + 'AR5": "' + unitpath + '/44.html",\n';      moreids += '\t\t "' + gnun + 'AR6": "' + unitpath + '/45.html",\n';      moreids += '\t\t "' + gnun + 'AR7": "' + unitpath + '/46.html",\n';      moreids += '\t\t "' + gnun + 'AR8": "' + unitpath + '/47.html",\n';      moreids += '\t\t "' + gnun + 'AR9": "' + unitpath + '/48.html",\n';      moreids += '\t\t "' + gnun + 'AR10": "' + unitpath + '/49.html"';      if(grade.toLowerCase() == '2')      {        moreids += ',\n';        moreids += '\t\t "' + gnun + 'AR11": "' + unitpath + '/50.html",\n';        moreids += '\t\t "' + gnun + 'AR12": "' + unitpath + '/51.html"\n';      }      else      {        moreids += '\n';      }    }    else    {      moreids += '\t\t "' + gnun + 'W1G": "' + unitpath + '/19.html",\n';      moreids += '\t\t "' + gnun + 'W1P": "' + unitpath + '/20.html",\n';      moreids += '\t\t "' + gnun + 'W1L1": "' + unitpath + '/21.html",\n';      moreids += '\t\t "' + gnun + 'W1L2": "' + unitpath + '/22.html",\n';      moreids += '\t\t "' + gnun + 'W1L3": "' + unitpath + '/23.html",\n';      moreids += '\t\t "' + gnun + 'W1L4": "' + unitpath + '/24.html",\n';      moreids += '\t\t "' + gnun + 'W1L5": "' + unitpath + '/25.html",\n';      moreids += '\t\t "' + gnun + 'W1L6": "' + unitpath + '/26.html",\n';      moreids += '\t\t "' + gnun + 'W1L7": "' + unitpath + '/27.html",\n';      moreids += '\t\t "' + gnun + 'W1L8": "' + unitpath + '/28.html",\n';      moreids += '\t\t "' + gnun + 'W1L9": "' + unitpath + '/29.html",\n';      moreids += '\t\t "' + gnun + 'W1L10": "' + unitpath + '/30.html",\n';      moreids += '\t\t "' + gnun + 'W1L11": "' + unitpath + '/31.html",\n';      moreids += '\t\t "' + gnun + 'W1L12": "' + unitpath + '/32.html",\n';      moreids += '\t\t "' + gnun + 'W1L13": "' + unitpath + '/33.html",\n';      moreids += '\t\t "' + gnun + 'W1L14": "' + unitpath + '/34.html",\n';      moreids += '\t\t "' + gnun + 'W2G": "' + unitpath + '/35.html",\n';      moreids += '\t\t "' + gnun + 'W2P": "' + unitpath + '/36.html",\n';      moreids += '\t\t "' + gnun + 'W2L1": "' + unitpath + '/37.html",\n';      moreids += '\t\t "' + gnun + 'W2L2": "' + unitpath + '/38.html",\n';      moreids += '\t\t "' + gnun + 'W2L3": "' + unitpath + '/39.html",\n';      moreids += '\t\t "' + gnun + 'W2L4": "' + unitpath + '/40.html",\n';      moreids += '\t\t "' + gnun + 'W2L5": "' + unitpath + '/41.html",\n';      moreids += '\t\t "' + gnun + 'W2L6": "' + unitpath + '/42.html",\n';      moreids += '\t\t "' + gnun + 'W2L7": "' + unitpath + '/43.html",\n';      moreids += '\t\t "' + gnun + 'W2L8": "' + unitpath + '/44.html",\n';      moreids += '\t\t "' + gnun + 'W2L9": "' + unitpath + '/45.html",\n';      moreids += '\t\t "' + gnun + 'W2L10": "' + unitpath + '/46.html",\n';      moreids += '\t\t "' + gnun + 'W2L11": "' + unitpath + '/47.html",\n';      moreids += '\t\t "' + gnun + 'W2L12": "' + unitpath + '/48.html",\n';      moreids += '\t\t "' + gnun + 'W2L13": "' + unitpath + '/49.html",\n';      moreids += '\t\t "' + gnun + 'W3G": "' + unitpath + '/50.html",\n';      moreids += '\t\t "' + gnun + 'W3P": "' + unitpath + '/51.html",\n';      moreids += '\t\t "' + gnun + 'W3L1": "' + unitpath + '/52.html",\n';      moreids += '\t\t "' + gnun + 'W3L2": "' + unitpath + '/53.html",\n';      moreids += '\t\t "' + gnun + 'W3L3": "' + unitpath + '/54.html",\n';      moreids += '\t\t "' + gnun + 'W3L4": "' + unitpath + '/55.html",\n';      moreids += '\t\t "' + gnun + 'W3L5": "' + unitpath + '/56.html",\n';      moreids += '\t\t "' + gnun + 'W3L6": "' + unitpath + '/57.html",\n';      moreids += '\t\t "' + gnun + 'W3L7": "' + unitpath + '/58.html",\n';      moreids += '\t\t "' + gnun + 'W3L8": "' + unitpath + '/59.html",\n';      moreids += '\t\t "' + gnun + 'W3L9": "' + unitpath + '/60.html",\n';      moreids += '\t\t "' + gnun + 'W3L10": "' + unitpath + '/61.html",\n';      moreids += '\t\t "' + gnun + 'W3L11": "' + unitpath + '/62.html",\n';      moreids += '\t\t "' + gnun + 'W3L12": "' + unitpath + '/63.html",\n';      moreids += '\t\t "' + gnun + 'W3L13": "' + unitpath + '/64.html",\n';      moreids += '\t\t "' + gnun + 'AR1": "' + unitpath + '/65.html",\n';      moreids += '\t\t "' + gnun + 'AR2": "' + unitpath + '/66.html",\n';      moreids += '\t\t "' + gnun + 'AR3": "' + unitpath + '/67.html",\n';      moreids += '\t\t "' + gnun + 'AR4": "' + unitpath + '/68.html",\n';      moreids += '\t\t "' + gnun + 'AR5": "' + unitpath + '/69.html",\n';      moreids += '\t\t "' + gnun + 'AR6": "' + unitpath + '/70.html",\n';      moreids += '\t\t "' + gnun + 'AR7": "' + unitpath + '/71.html",\n';      moreids += '\t\t "' + gnun + 'AR8": "' + unitpath + '/72.html",\n';      moreids += '\t\t "' + gnun + 'AR9": "' + unitpath + '/73.html",\n';      moreids += '\t\t "' + gnun + 'AR10": "' + unitpath + '/74.html",\n';      moreids += '\t\t "' + gnun + 'AR11": "' + unitpath + '/75.html",\n';      moreids += '\t\t "' + gnun + 'AR12": "' + unitpath + '/76.html"\n';    }        // fixedHTML = fixedHTML.replace(/"id": "(.*?)",/, '"id": "$1",\n"vcode": "$1",');    // fixedHTML = fixedHTML.replace(/"bookTitle": "(.*?)",/, '"bookTitle": "$1",\n"title": "$1",');    // fixedHTML = fixedHTML.replace(/\},/, '},\n\t"pageIds": {\n\t},');    var vcode = '';    var title = '';    try{      vcode = fixedHTML.match(/"id": "(.*?)",/)[0].replace(/"id": "(.*?)",/, '$1');    }catch(e){      vcode = fixedHTML.match(/"vcode": "(.*?)",/)[0].replace(/"vcode": "(.*?)",/, '$1');    }    try{      title = fixedHTML.match(/"bookTitle": "(.*?)",/)[0].replace(/"bookTitle": "(.*?)",/, '$1');    }catch(e){      title = fixedHTML.match(/"title": "(.*?)",/)[0].replace(/"title": "(.*?)",/, '$1');    }    fixedHTML = '';    fixedHTML += '{\n';    fixedHTML += '\t"launchPage": "html/index.html",\n';    fixedHTML += '\t"title": "'+title+'",\n';    fixedHTML += '\t"vcode": "'+vcode+'",\n';    fixedHTML += '\t"pageIds": {\n';    fixedHTML += '\t}\n';    fixedHTML += '}\n';    fixedHTML = fixedHTML.replace(/"pageIds": \{/, '"pageIds": {\n' + moreids);    //get rid of the last comma for real this time    if(fixedHTML.match(/week3\/lesson13\.html",/))    {      fixedHTML = fixedHTML.replace(/(week3\/lesson13\.html"),/, '$1');    }    else if(fixedHTML.match(/week3\/day5\/lesson17.html",/))    {      fixedHTML = fixedHTML.replace(/(week3\/day5\/lesson17\.html"),/, '$1');    }    else    {      fixedHTML = fixedHTML.replace(/(week3\/day5\/lesson4\.html"),/, '$1');    }    fileCounter++;    // log('print PDF button fixed!');  // }}function makepdfpages(){  var numberOfPDFs = 49;  if(grade == '2')    numberOfPDFs = 51;  if(grade == '3' || grade == '4' || grade == '5' || grade == '6')    numberOfPDFs = 76;  for(var n = 1; n <= numberOfPDFs; n++)  {    var pdfpagecontents = [];    pdfpagecontents.push('<!DOCTYPE html>');    pdfpagecontents.push('<html>');    pdfpagecontents.push('<head>');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/bench-styles/bec_12.css">');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/bench-styles/Front-matter-common.css">');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/fonts/fonts.css">');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/icons/icons.css">');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/logos.css">');    pdfpagecontents.push('    <link rel="stylesheet" href="/css/themes/default.css">');    pdfpagecontents.push('</head>');    pdfpagecontents.push('<body>');    pdfpagecontents.push('    <main>');    pdfpagecontents.push('        <iframe class="pdf" src="/pdfs/'+n+'.pdf#view=Fit"></iframe>');    pdfpagecontents.push('    </main>');    pdfpagecontents.push('</html>');    var pdfpage = create_file(product_folder + '/html/'+n+'.html');    pdfpage.open('w');    pdfpagecontents = pdfpagecontents.join('\n');    pdfpage.write(pdfpagecontents);    pdfpage.close();  }}function GetXcodeFolders(theFolder){   var myFileList = theFolder.getFiles();     for (var i = 0; i < myFileList.length; i++)    {          var myFile = myFileList[i];          if (myFile instanceof Folder && myFile.fsName.match(/X\d+/))        {               xcodeFolders.push(myFile);          }   }}function GetSubFolders(theFolder) {  if (!(theFolder.name.match(/old$/i)) && !(theFolder.name.match(/rrhtml$/i)))  {       var myFileList = theFolder.getFiles();         for (var i = 0; i < myFileList.length; i++)        {              var myFile = myFileList[i];              if (myFile instanceof Folder)            {                   GetSubFolders(myFile);              }              else if (myFile instanceof File && myFile.name.match(/\.json$/i))             {                   myFiles.push(myFile);              }         }     }}//by Mikefunction returnSplit(file, mode) {    if (mode.match(/\n/)) {        file.open('r');        str = file.read();    } else {        str = file;    }    str = str.split(mode);    return str;}