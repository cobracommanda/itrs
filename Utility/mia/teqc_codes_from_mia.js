$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/console.js');start_log();$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/library.js');$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/exporter.js');$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/zone.js');$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/json.js');notifications_off();var teqcs = [{ycode: 'Y35618'},{ycode: 'Y35615'},{ycode: 'Y35612'},{ycode: 'Y35609'},{ycode: 'Y35621'},{ycode: 'Y37100'},{ycode: 'Y37788'},];function f_curl_mia(code, url_type) {  var path = '~/Desktop/MIA';  var filename = 'json_mia.json';  url_type = !!url_type ? url_type : 'sibling_components';    var json_file = create_file(path+'/'+filename);  if(json_file.exists){    json_file.remove();    json_file = create_file(path+'/'+filename);  }  var com_file = create_file('~/Desktop/MIA/curl_mia.command');    com_file.open('w');  com_file.writeln('cd '+path);  com_file.writeln('curl -o '+filename+' https://mia.benchmarkconnect.com/api/freeandclear/Vn1f6H3sq7n2kFD/'+url_type+'?codes=' + code);  // com_file.writeln('#osascript -e 'tell application "Terminal" to quit' & exit"');  com_file.close();    var text = '';  text += 'do shell script "chmod 777 ~/Desktop/MIA/curl_mia.command"';  app.doScript(text, ScriptLanguage.APPLESCRIPT_LANGUAGE);    com_file.execute();  return json_file;}function get_code_from_json_file(file, code, format, scope){    var json_file = file;    while(!json_file.exists){    $.sleep(500);  }  json_file.open('r');  var text = json_file.read();  var json = JSON.parse(text);   var xcode = false;  var components = '';  if(!!scope){    var pedagogically_related_content = json["data"][code][scope];    for (var property in pedagogically_related_content) {      if (pedagogically_related_content.hasOwnProperty(property)) {        components = json["data"][code][scope][property].components;        for (var c_prop in components) {          if (components.hasOwnProperty(c_prop)) {            if(components[c_prop].delivery_format == format){              xcode = components[c_prop].o_code.replace(/O-/ig, '');            }          }        }      }    }  }else{    components = json["data"][code].components;    for (var property in components) {      if (components.hasOwnProperty(property)) {        if(components[property].delivery_format == format){          xcode = components[property].o_code.replace(/O-/ig, '');        }      }    }  }   json_file.remove();  return xcode;}function close_all_terminal_windows(){  var text = '';  text += 'tell application "Terminal"\r';  text += '\tclose every window\r';  text += 'end tell\r';  app.doScript(text, ScriptLanguage.APPLESCRIPT_LANGUAGE);}function get_codes_from_json_file(file, code, scope, marker){    var json_file = file;    while(!json_file.exists){    $.sleep(500);  }  json_file.open('r');  var text = json_file.read();  var json = JSON.parse(text);   var results = [];  var components = '';  var pedagogically_related_content = json["data"][code][scope];  for(var property in pedagogically_related_content){    if(pedagogically_related_content.hasOwnProperty(property)){      if(pedagogically_related_content[property].content_type == marker.content_type &&         pedagogically_related_content[property].series != 'Benchmark Workshop: Reader\'s Workshop'){        components = json["data"][code][scope][property].components;        results.push(pedagogically_related_content[property].series);        for(var c_prop in components){          if(components.hasOwnProperty(c_prop)){            results.push(c_prop);          }        }       }    }  }   json_file.remove();  return results;}function collect_codes(){  teqcs.forEach(function(teqc){    var file = f_curl_mia(teqc.ycode);        try{      teqc.xcode = get_code_from_json_file(file, teqc.ycode, 'html');      file = f_curl_mia(teqc.xcode, 'related_pedagogical_components');      teqc.leveled_text = get_code_from_json_file(file, teqc.xcode, 'html_becreader', 'pedagogically_related_content');      file = f_curl_mia(teqc.leveled_text, 'related_pedagogical_components');      var marker = {series: "Benchmark Workshop: Reader's Workshop", content_type: "Teacher's Guide"};      teqc.brw_tg_codes = get_codes_from_json_file(file, teqc.leveled_text, 'pedagogically_related_content', marker);        file = f_curl_mia(teqc.leveled_text, 'related_pedagogical_components');      var marker = {content_type: "Teacher's Guide"};      teqc.tg_codes = get_codes_from_json_file(file, teqc.leveled_text, 'pedagogically_related_content', marker);    }catch(e){      // teqc.xcode = '';      // teqc.leveled_text = '';      // teqc.brw_tg_codes = '';      // teqc.tg_codes = '';    }finally{      log(teqc.ycode+'\t'+teqc.xcode+'\t'+teqc.leveled_text+'\t'+teqc.brw_tg_codes+'\t'+teqc.tg_codes);      // log(teqc.leveled_text+'\t'+teqc.tg_codes);      close_all_terminal_windows();    }      });}(function(){  timer_off = true;  collect_codes();})();end_log();