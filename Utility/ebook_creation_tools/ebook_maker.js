//CREATOR JY//CREATED 2017-03-06//UPDATED 2017-03-06//VERSION 1.0$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/console.js');$.evalFile('/Users/' + $.getenv('USER') + '/Library/Preferences/Adobe InDesign/Version 11.0/en_US/Scripts/Scripts Panel/team scripts/Jason/Utility/exporter.js');start_log();if(!document){ throw 'ERROR: document not found!'; }var products = [	{ycode: 'Y31956', xcode: 'X44749', isbn: '978-1-5322-2047-0', title: 'All About Me'},	{ycode: 'Y31969', xcode: 'X44762', isbn: '978-1-5322-2060-9', title: 'Families and Friends'},	{ycode: 'Y31932', xcode: 'X44770', isbn: '978-1-5322-1997-9', title: 'Communities and Health'},	{ycode: 'Y31197', xcode: 'X44785', isbn: '978-1-5322-0595-8', title: 'Community Jobs and Fall'},	{ycode: 'Y31933', xcode: 'X44800', isbn: '978-1-5322-1998-6', title: 'Celebrations and Winter'},	{ycode: 'Y31360', xcode: 'X43779', isbn: '978-1-5322-0758-7', title: 'Animals'},	{ycode: 'Y31361', xcode: 'X43790', isbn: '978-1-5322-0759-4', title: 'Transportation'},	{ycode: 'Y31362', xcode: 'X43802', isbn: '978-1-5322-0760-0', title: 'Spring and Growing Things'},	{ycode: 'Y31363', xcode: 'X43818', isbn: '978-1-5322-0761-7', title: 'Farms and Food Sources'},		{ycode: 'Y31364', xcode: 'X43832', isbn: '978-1-5322-0762-4', title: 'Insects and Ecology'}];var product = get_product();var page_numbers = [];var _pages = []; var package_folder = create_folder('/Volumes/BEC/15 User Files/INDD SCRIPTS/primitive/_JY_BU/JasonONE_DRIVE_UNSORTED/OneDrive - Benchmark Education/projects/eBooks/products/rta/student_consumable_books/unit5/X44800');(function(){		format_document();	var spreads = document.spreads;	var l = spreads.length;		for(var x = 0 ; x < l; x++){		var spread = spreads[x];		process_spread(spread, x);	}	process_document();})(); function format_document(){	app.pdfExportPreferences.pageRange = PageRange.ALL_PAGES;	document.viewPreferences.horizontalMeasurementUnits = MeasurementUnits.PIXELS;	document.viewPreferences.verticalMeasurementUnits = MeasurementUnits.PIXELS;	app.activeWindow.transformReferencePoint = AnchorPoint.TOP_LEFT_ANCHOR;	document.viewPreferences.rulerOrigin = RulerOrigin.SPREAD_ORIGIN;	// document.viewPreferences.rulerOrigin = RulerOrigin.PAGE_ORIGIN;	document.zeroPoint = [0, 0];	document.layoutWindows[0].viewDisplaySetting = ViewDisplaySettings.HIGH_QUALITY;}function process_spread(spread, index){		var pages = spread.pages;	var page_number = 'page';	switch(true){		case (pages.length == 1 && index == 0): page_number = 'cover'; break;		case (pages.length == 1): page_number = 'backcover'; break;		case (index == 1): page_number += '000001'; break;			default: page_number += format_page_number(pages[0].name) + format_page_number(pages[1].name);		}	 	page_numbers.push(page_number);	create_html(spread, page_number);	create_css(page_number);	create_images(spread, page_number);	create_thumbnails(spread, page_number);}function format_page_number(string){	var number = string;	while(number.length < 3){		number = '0'+number;	}	return number;}function create_html(spread, page_number){	var parent_folder = create_folder(package_folder+'/html');	var folder = create_folder(parent_folder+'/'+page_number);	var file = create_file(folder+'/'+page_number+'.html');	var width = spread.pages[spread.pages.length-1].bounds[3];		var height = spread.pages[spread.pages.length-1].bounds[2];	if(!page_number.match(/cover/i)){		var left_page = page_number.replace(/\d{3}$/, '');		var right_page = page_number.replace(/page\d{3}/, 'page');			_pages.push(left_page);		_pages.push(right_page);	}else{		_pages.push(page_number);	}	var text = '';	text += '<!DOCTYPE html>\n';	text += '<html>\n';	text += '<head>\n';	text += '<title></title>\n';	text += '<link rel="stylesheet" href="../../css/css_'+page_number+'.css"/>\n';	text += '<meta name="viewport" content="width='+width+', height='+height+'" />\n';	text += '<meta charset="UTF-8">\n';	text += '</head>\n';	text += '<body>\n';	text += '<div class="EB_'+product.xcode+'_'+page_number+'">\n';	if(!!page_number.match(/cover/i)){		text += '<div class="'+page_number+'"><img src="../../images/'+page_number+'.jpg" /></div>\n';	}else{ 			text += '<div class="'+left_page+'"><img src="../../images/'+left_page+'.jpg" /></div>\n';		text += '<div class="'+right_page+'"><img src="../../images/'+right_page+'.jpg" /></div>\n';	}			text += '</div>\n';	text += '</body>\n';	text += '</html>\n';	file.open('w');	file.write(text);	file.close();} function create_css(page_number){	var folder = create_folder(package_folder+'/css');	var file = create_file(folder+'/css_'+page_number+'.css');	var text = '';	text += 'body{\n';	text += '\tmargin: 0 auto;\n';	text += '\twidth: 100%;\n';	text += '\tfont-size: 0;\n';	text += '}\n';	text += 'div{\n';	text += '\tdisplay: inline-block;\n';	if(!!page_number.match(/cover/i)){		text += '\twidth: 100%;\n';	}else{		text += '\twidth: 50%;\n';	}		text += '}\n';	text += 'div img{\n';	text += '\twidth: 100%;\n';	text += '}\n'; 	file.open('w');	file.write(text);	file.close();}function set_jpg_export_preference_to_page(){	app.jpegExportPreferences.jpegColorSpace = JpegColorSpaceEnum.RGB;	app.jpegExportPreferences.jpegExportRange = ExportRangeOrAllPages.EXPORT_RANGE;	app.jpegExportPreferences.jpegQuality = JPEGOptionsQuality.HIGH;	app.jpegExportPreferences.exportResolution = 72;  app.jpegExportPreferences.exportingSpread = false;     }function set_jpg_export_preference_to_thumbnail(){	app.jpegExportPreferences.jpegColorSpace = JpegColorSpaceEnum.RGB;	app.jpegExportPreferences.jpegExportRange = ExportRangeOrAllPages.EXPORT_RANGE;	app.jpegExportPreferences.jpegQuality = JPEGOptionsQuality.MEDIUM;	app.jpegExportPreferences.exportResolution = 16;  app.jpegExportPreferences.exportingSpread = true;       }function export_jpg(page_string, name, folder){	app.jpegExportPreferences.pageString = page_string;	  image_name = name + '.jpg';   image_path = folder + separator + image_name;  var image_file = File(image_path);  if(!image_file.exists){  	document.exportFile(ExportFormat.JPG, image_file);	  } }function set_pdf_export_preferences(){	app.pdfExportPreferences.generateThumbnails = true;  app.pdfExportPreferences.pdfColorSpace = PDFColorSpace.RGB;   app.pdfExportPreferences.exportReaderSpreads = true;  app.pdfExportPreferences.colorBitmapCompression = BitmapCompression.JPEG;  app.pdfExportPreferences.colorBitmapQuality = CompressionQuality.MEDIUM;    app.pdfExportPreferences.colorBitmapSampling = Sampling.BICUBIC_DOWNSAMPLE;  app.pdfExportPreferences.colorBitmapSamplingDPI = 72;    app.pdfExportPreferences.compressTextAndLineArt = true;  app.pdfExportPreferences.compressionType = PDFCompressionType.COMPRESS_STRUCTURE;  app.pdfExportPreferences.grayscaleBitmapCompression = BitmapCompression.JPEG;  app.pdfExportPreferences.grayscaleBitmapQuality = CompressionQuality.MEDIUM;    app.pdfExportPreferences.grayscaleBitmapSampling = Sampling.BICUBIC_DOWNSAMPLE;  app.pdfExportPreferences.grayscaleBitmapSamplingDPI = 72;    app.pdfExportPreferences.monochromeBitmapCompression = MonoBitmapCompression.ZIP;  app.pdfExportPreferences.monochromeBitmapSampling = Sampling.BICUBIC_DOWNSAMPLE;  app.pdfExportPreferences.monochromeBitmapSamplingDPI = 72;}function create_images(spread, page_number){	set_jpg_export_preference_to_page();	var folder = create_folder(package_folder+'/images');	if(!page_number.match(/cover/i)){		var left_page = page_number.replace(/\d{3}$/, '');		var right_page = page_number.replace(/page\d{3}/, 'page');				export_jpg(spread.pages[0].name, left_page, folder);		export_jpg(spread.pages[1].name, right_page, folder);	}else{		current_page = spread.pages[0];		export_jpg(spread.pages[0].name, page_number, folder);		}	}function create_thumbnails(spread, page_number){	set_jpg_export_preference_to_thumbnail();	var folder = create_folder(package_folder+'/thumbnails');		export_jpg(spread.pages[0].name, page_number, folder);}function process_document(){	create_spread_index();		create_pdf();	create_content_opf();}function create_spread_index(){	var folder = create_folder(package_folder+'/spread_index');	var file = create_file(folder+'/spread-index.json');	var text = '';	text += 'spreads:{\n';	var l = page_numbers.length;	for(var x = 0; x < l; x++){		var page_number = page_numbers[x];		text += '  "'+x+'":[  \n';		text += '    "'+page_number+'"\n';		text += '  ]'+(x < l-1 ? ',' : '')+'\n';	}	text += '}\n';		file.open('w');	file.write(text);	file.close();}function create_pdf(){	set_pdf_export_preferences();	var folder = create_folder(package_folder+'/pdf');	var file = create_file(folder +'/print.pdf');	if(!file.exists){  	try{  		document.exportFile(ExportFormat.PDF_TYPE, file);  	}catch(e){  		app.pdfExportPreferences.compressionType = PDFCompressionType.COMPRESS_NONE;  		document.exportFile(ExportFormat.PDF_TYPE, file);  	}  } }function create_content_opf(){	var file = create_file(package_folder+'/content.opf');	var text = '';	text += '<?xml version="1.0" encoding="UTF-8"?>\n';	text += '<package xmlns="http://www.idpf.org/" version="3.0" xml:lang="en" unique-identifier="epub'+product.isbn+'" prefix="rendition: http://www.idpf.org/vocab/rendition/#">\n';	text += '\t<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n';	text += '\t\t<dc:title>'+product.title+'</dc:title>\n';	text += '\t\t<dc:productcode>'+product.xcode+'</dc:productcode>\n';	text += '\t\t<dc:identifier id="epub'+product.isbn+'">'+product.isbn+'</dc:identifier>\n';	text += '\t\t<dc:language>en-US</dc:language>\n';	text += '\t\t<dc:creator>Benchmark Education Company</dc:creator>\n';	text += '\t\t<dc:publisher>Benchmark Education Company</dc:publisher>\n';	text += '\t\t<dc:rights>Benchmark Education Company, LLC.</dc:rights>\n';	text += '\t\t<meta name="cover" content="cover-image" />\n';	text += '\t\t<meta property="ibooks:version">3.0</meta>\n';	text += '\t\t<meta property="rendition:layout">pre-paginated</meta>\n';	text += '\t\t<meta property="rendition:orientation">landscape</meta>\n';	text += '\t\t<meta property="rendition:spread">both</meta>\n';	text += '\t</metadata>\n';	text += '\t<manifest>\n';	var l = page_numbers.length;	for(var x = 0; x < l; x++){		var page_number = page_numbers[x];		text += '\t\t<item id="css_'+page_number+'" href="css/css_'+page_number+'.css" media-type="text/css" /> \n'; 			}	var l = page_numbers.length;	for(var x = 0; x < l; x++){		var page_number = page_numbers[x];		text += '\t\t<item id="html_'+page_number+'" href="html/'+page_number+'/'+page_number+'.html" media-type="application/xhtml+xml" /> \n';	}	var l = _pages.length;	for(var x = 0; x < l; x++){		var _page = _pages[x];		text += '\t\t<item id="image_'+_page+'" href="images/'+_page+'.jpg" media-type="image/jpeg" /> \n';	}	text += '\t</manifest>\n';	text += '\t<spine toc="ncx">\n';	var l = page_numbers.length;	for(var x = 0; x < l; x++){		var page_number = page_numbers[x];		if(!!page_number.match(/cover/)){			text += '\t\t<itemref idref="'+page_number+'" /> \n';		}else{			text += '\t\t<itemref idref="'+page_number+'" property="rendition:spread" /> \n';			}	}	text += '\t</spine>\n';	text += '</package>\n';	file.open('w');	file.write(text);	file.close();}function get_product(){	var l = products.length;	for(var x = 0; x < l; x++){		if(!!document.name.match(RegExp(products[x].ycode))){			return products[x];		}	}	throw 'ERROR: product not found!';}end_log();